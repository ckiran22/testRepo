var enzTable=angular.module("enzTable",[]);function unSelect(a){$(a).parent("tr").hasClass("selected")?$(a).parent("tr").toggleClass("selected"):($("tr").removeClass("selected"),$(a).parent("tr").addClass("selected"))}
enzTable.directive("enzTablerow",function(){return{restrict:"AE",template:"",controller:["$scope","$element","$compile",function(a,h,g){var f="";angular.forEach(a.columns,function(c,g){f=c.template?f+('<td class="'+(c.showAlways?"showonmobile":"")+'" onclick="unSelect(this);" id='+c.label+" data-th="+c.label+"  >"+c.template+"</td>"):f+('<td class="'+(c.showAlways?"showonmobile":"")+'" onclick="unSelect(this);" id='+c.label+" data-th="+c.label+"  >"+(a.record[c.name]?a.record[c.name]:"")+"</td>")});
h.append(f);g(h.contents())(a);a.call=function(a){a()}}]}});
enzTable.directive("enzTable",function(){return{restrict:"AE",scope:{columns:"=columns",getdata:"&getdata",sortorder:"=sortorder",object:"=object"},template:'\r\n\t\t\t\t<a href="#" ng-click= "addColum()">test</a>\r\n\t\t\t\t<div style="text-align: right;margin-bottom: 10px;">\r\n\t\t\t\t\t<input type="search" ng-change="searchTextKeyup(currentPage)" ng-model="keyword" style="float:left" placeholder="Search">\r\n\t\t\t\t\t<div class="pager">\r\n\t\t\t\t\t\t<nav class="pagination">\r\n\t\t\t\t\t\t\t<a class="first" ng-click="checkPaginationEndPoint(1)"><<</a>\r\n\t\t\t\t\t\t\t<a class="prev" ng-click="addPage(-1)"><</a>\r\n\t\t\t\t\t\t\t<div class="pagedisplay">{{currentPage}}/{{pageCount}}</div>\r\n\t\t\t\t\t\t\t<a ng-click="addPage(1)">></a>\r\n\t\t\t\t\t\t\t<a ng-click="checkPaginationEndPoint(pageCount)">>></a>\r\n\t\t\t\t\t\t\t<select class="pagesize ng-pristine ng-untouched ng-valid" ng-model="pageSize" ng-change="callGetDataFunction(1)">\r\n\t\t\t\t\t\t\t\t<option selected="selected" value="5">5</option>\r\n\t\t\t\t\t\t\t\t<option value="10">10</option>\r\n\t\t\t\t\t\t\t\t<option value="20">20</option>\r\n\t\t\t\t\t\t\t\t<option value="30">30</option>\r\n\t\t\t\t\t\t\t\t<option value="40">40</option>\r\n\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t</nav>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n<div>\r\n\t<div>\r\n\t\t<table class="table list attachments responsive">\r\n\t\t\t<thead>\r\n\t\t\t\t<tr class="headerRow">\r\n\t\t\t\t\t<th name="{{column.name}}" disableSort={{column.disableSort}} ng-repeat="column in columns" ng-click="sort($event)">{{column.label}}<i style="font-size: 10px;" class="glyphicon"></i></th>\r\n\t\t\t\t</tr>\r\n\t\t\t</thead>\r\n\t\t\t<tbody>\r\n\t\t\t\t<tr ng-repeat="record in pagedRecords" enz-tablerow="record" columns="modifyColumns">\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t</div>\r\n</div>',controller:function(a,
h,g,f,c,k){a.records=[];a.currentPage=0;a.sortOrderCopy=angular.copy(a.sortorder);a.pageCount=1;a.pageSize=5;a.pagedRecords=[];a.sortAsc=!0;a.totalRecordsCount=-1;a.searchRecords=[];a.isDataComeFromServer=!1;a.barrier=1E3;a.totalRecordsCount=a.barrier+1;a.searchTotalRecordsCount=a.barrier+1;a.keyword="";a.addPage=function(b){a.checkPaginationEndPoint(a.currentPage+b)};a.modifyColumnsName=function(){a.modifyColumns=[];a.columns&&(a.modifyColumns=angular.copy(a.columns),angular.forEach(a.modifyColumns,
function(a){a.name=a.name.replace(".","_")}))};a.modifyColumnsName();a.setPage=function(b,e){var d=g("filter")(a.recordsToProcess,a.keyword);a.pageCount=d&&0<=d.length?Math.ceil((e?e==a.recordsToProcess.length?d.length:e:d.length)/a.pageSize):0;0==a.pageCount?(a.currentPage=1,a.pagedRecords=[]):(b>a.pageCount?b=a.pageCount:0>=b&&(b=1),0==a.pageCount&&(a.pageCount=1),0<b&&b<=a.pageCount&&(a.currentPage=b,a.pagedRecords=a.isDataComeFromServer?d:g("orderBy")(d,a.sortBy,!a.sortAsc).splice((b-1)*a.pageSize,
a.pageSize)))};a.sort=function(b){var e=$(b.currentTarget).attr("name");"true"!=$(b.currentTarget).attr("disableSort")&&(a.sortBy==e?a.sortAsc=!a.sortAsc:(k.find("i").removeClass("glyphicon-arrow-up glyphicon-arrow-down"),a.sortAsc=!0,a.sortBy=e),$(b.currentTarget).find("i").removeClass("glyphicon-arrow-up glyphicon-arrow-down").addClass(a.sortAsc?"glyphicon-arrow-up":"glyphicon-arrow-down"),a.sortOrderCopy=[],a.sortOrderCopy=[{name:e,direction:a.sortAsc?"asc":"desc"}],(a.keyword?a.searchTotalRecordsCount<=
a.searchRecords.lenght:a.totalRecordsCount<=a.records.lenght)?a.setPage(a.currentPage):a.callGetDataFunction(a.currentPage))};a.callGetDataFunction=function(b){a.isDataComeFromServer=!1;if(a.records.length<a.totalRecordsCount)if(-1!=a.keyword.indexOf(a.previousKeyword)&&a.searchRecords.length==a.searchTotalRecordsCount)a.recordsToProcess=angular.copy(a.searchRecords),a.setPage(b);else{a.searchRecords=[];var e=a.keyword?a.searchTotalRecordsCount<=a.barrier:a.totalRecordsCount<=a.barrier;a.getdata({callback:function(d){a.records=
d.Data;a.records&&(a.records=a.getObjectValue(a.records));a.recordsToProcess=angular.copy(a.records);a.keyword?(a.searchTotalRecordsCount=d.TotalCount,a.searchRecords=angular.copy(a.records)):a.totalRecordsCount=d.TotalCount;a.isDataComeFromServer=!0;if(a.records.length>=a.totalRecordsCount||a.records.length>=a.searchTotalRecordsCount)a.isDataComeFromServer=!1;a.setPage(b,a.keyword?a.searchTotalRecordsCount:a.totalRecordsCount);a.$apply()},object:a.object.objectName,queryFields:a.object.queryfields,
criteria:a.object.criteria,sortOrder:a.sortOrderCopy,keyword:e&&!a.keyword?"":a.keyword,offset:e?-1:b,size:e?-1:a.pageSize})}else a.recordsToProcess=angular.copy(a.records),a.setPage(b)};a.searchTextKeyup=function(b){a.timer&&f.cancel(a.timer);a.timer=f(function(){0<=a.keyword.indexOf(a.previousKeyword)?a.searchTotalRecordsCount!=a.searchRecords.length?a.callGetDataFunction(b):(a.recordsToProcess=angular.copy(a.searchRecords),a.isDataComeFromServer=!1,a.setPage(b)):a.callGetDataFunction(b);a.previousKeyword=
a.keyword},800)};a.checkPaginationEndPoint=function(b){0>=b?a.currentPage=1:b>=a.pageCount+1?a.currentPage=a.pageCount:a.currentPage==b?a.currentPage=b:a.callGetDataFunction(b)};a.callGetDataFunction(1);a.getObjectValue=function(b){b&&0<b.length&&angular.forEach(b,function(b){angular.forEach(a.columns,function(a){if(a.name&&(a=a.name.split("."),1<a.length)){var c=angular.copy(b);angular.forEach(a,function(a){c&&(c=c[a])});b[a.join("_")]=c}})});return b};a.filterRecord=function(b,c,d){var f=[];if(c)angular.forEach(b,
function(b){for(var g=0;g<d.length;g++)if(a.filteredData=b[d[g].name],a.filteredData&&("string"!=$.type(a.filteredData)&&(a.filteredData+=""),-1!=angular.lowercase(a.filteredData).indexOf(angular.lowercase(c)||""))){f.push(b);break}});else return b;return f}}}});
